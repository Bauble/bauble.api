#!/usr/bin/env python

import os
import sys
import subprocess

import bauble

try:
    import baker
except Exception as e:
    # TODO install baker and rerun
    print("baker not installed. pip install 'baker>=1.3,<2.0a0'")
    raise

os.environ['PYTHONPATH'] = os.getcwd()

@baker.command
def test(*args):
    """
    Deploy to the production environment.
    """
    pytest_args = ['py.test', 'test/spec'] if len(args) is 0 else ['py.test'] + args
    os.execvpe('py.test', pytest_args, os.environ)


@baker.command
def virtualenv():
    # TODO: create the virtualenv and install the dependencies
    pass


@baker.command
def deploy():
    """
    Deploy to the production environment.
    """
    # TODO: copy to server and restart server
    pass


@baker.command(default=True)
def server(environment="dev"):
    """
    Start the server
    """
    os.execlp("uwsgi", "uwsgi", "--ini", "uwsgi.ini:{}".format(environment))


baker.run()
